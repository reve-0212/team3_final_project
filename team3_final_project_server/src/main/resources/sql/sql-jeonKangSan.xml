<?xml version="1.0" encoding="UTF-8"?>
<!--sql-jeonKangSan.xml-->
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.team3_final_project_server.JunKangSan.JKSMapper">

    <select id="getAllRestaurants" resultType="com.example.team3_final_project_server.dto.RestaurantDTO">
        SELECT *
        FROM restaurant
    </select>

<!--    <select id="getAllBestMenus" parameterType="int" resultType="com.example.team3_final_project_server.dto.BestMenuDTO">-->
<!--        SELECT *-->
<!--        FROM bestmenu-->
<!--        WHERE testres_idx = #{resIdx}-->
<!--        LIMIT 3-->
<!--    </select>-->

    <select id="getAllReviews" parameterType="int" resultType="com.example.team3_final_project_server.dto.ReviewDTO">
        SELECT *
        FROM review
        WHERE res_idx = #{resIdx}
    </select>

<!--    <select id="getLatestAnnounce" resultType="com.example.team3_final_project_server.dto.AnnounceDTO">-->
<!--        SELECT *-->
<!--        FROM announce-->
<!--        ORDER BY announce_idx DESC-->
<!--        LIMIT 1-->
<!--    </select>-->

<!--    <select id="getAmenitiesByResIdx" resultType="com.example.team3_final_project_server.dto.AmenitiesDTO">-->
<!--        SELECT-->
<!--        amenities_idx,-->
<!--        res_idx,-->
<!--        has_parking,-->
<!--        parking_info,-->
<!--        no_deposit,-->
<!--        deposit_info,-->
<!--        has_group_seat,-->
<!--        group_seat_info,-->
<!--        has_coronation,-->
<!--        coronation_info,-->
<!--        has_corkage,-->
<!--        corkage_info,-->
<!--        has_kids_zone,-->
<!--        kids_zone_info,-->
<!--        has_wifi,-->
<!--        wifi_info,-->
<!--        has_waiting_area,-->
<!--        waiting_area_info-->
<!--        FROM amenities-->
<!--        WHERE res_idx = #{resIdx}-->
<!--    </select>-->

    <select id="getRestaurantsByResIdx" resultType="com.example.team3_final_project_server.dto.RestaurantDTO">
        SELECT
        res_idx,
        res_image1,
        res_image2,
        res_image3,
        res_name,
        res_call,
        res_address1,
        res_address2,
        res_introduce,
        res_reserve_time,
        res_lat,
        res_lng,
        res_price_range,
        reserve_or_waiting,
        res_option_1
        FROM restaurant
        WHERE res_idx = #{resIdx}
    </select>

    <select id="getAvgRatingByResIdx" resultType="Double">
        SELECT ROUND(AVG(review_rating), 1)
        FROM review
        WHERE res_idx = #{resIdx}
    </select>

    <select id="getAvgRatingByType" resultType="map">
        SELECT
        review_type,
        ROUND(AVG(review_rating), 1) AS avg_rating
        FROM review
        WHERE res_idx = #{resIdx}
        GROUP BY review_type
    </select>

    <select id="getCategoryByAddress"
            parameterType="string"
            resultType="com.example.team3_final_project_server.dto.CategoryDTO">
        SELECT
        category_idx,
        res_idx,
        category_addr,
        category_name,
        category_tag
        FROM category
        WHERE category_addr LIKE CONCAT('%', #{categoryAddr}, '%')
    </select>

    <select id="getRstListByCategory" parameterType="int">
        select * from restaurant where res_idx = 1;
    </select>

    <select id="getRstListByPath" parameterType="int">
        select * from restaurant where res_idx = 1;
    </select>

    <select id="getBestMenu" resultType="com.example.team3_final_project_server.dto.MenuDTO">
        select m.menu_name, m.menu_price, m.menu_explanation, m.menu_image
        from menu as m
        join restaurant as r
        on m.res_idx = r.res_idx
        where r.res_idx = #{resIdx};
    </select>


</mapper>
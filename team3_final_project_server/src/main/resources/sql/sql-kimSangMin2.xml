<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.team3_final_project_server.KimSangMin.mapper.PreMapper">

    <!--    좌석 저장 -->
    <insert id="saveSeat">
        INSERT INTO seat_table (res_idx, res_seat_id, type, name, x, y, image, is_selected)
        VALUES (#{resIdx}, #{resSeatId},  #{type}, #{name}, #{x}, #{y}, #{image}, #{isSelected})
    </insert>

<!--    가게 좌석 고유 번호 -->
    <select id="getResSeatNum" parameterType="int" resultType="java.lang.Integer">
        SELECT MAX(res_seat_id)
        FROM seat_table
        WHERE res_idx = #{resIdx}
    </select>

    <insert id="cateSave">
        INSERT INTO category (res_idx, category_addr, category_name, category_tag )
        VALUES (#{resIdx}, #{categoryAddr} , #{categoryName}, #{categoryTag} )
    </insert>

    <select id="checkSeatExists" resultType="boolean">
        SELECT COUNT(*) > 0
        FROM seat_table
        WHERE res_idx = #{resIdx} AND x = #{x} AND y = #{y}
    </select>

    <select id="findResIdx" resultType="int" parameterType="int">
        SELECT res_idx
        FROM restaurant
        WHERE user_idx = #{userIdx}
    </select>



<!--    가게 정보 저장 -->
    <insert id="reSave" parameterType="com.example.team3_final_project_server.dto.RestaurantDTO">
    INSERT INTO restaurant ( user_idx ,res_name, res_call, res_address1, res_address2, res_introduce, res_reserve_time, res_image1, res_image2, res_image3)
    VALUES (#{userIdx} ,#{resName}, #{resCall}, #{resAddress1}, #{resAddress2}, #{resIntroduce}, #{resReserveTime}, #{resImage1}, #{resImage2}, #{resImage3} )
    </insert>

<!--    가게 정보 수정 -->
    <update id="updateRest">
        UPDATE restaurant SET
            res_image1 = #{storeData.resImage1},
            res_image2 = #{storeData.resImage2},
            res_image3 = #{storeData.resImage3},
            res_name = #{storeData.resName},
            res_call = #{storeData.resCall},
            res_address1 = #{storeData.resAddress1},
            res_address2 = #{storeData.resAddress2},
            res_introduce = #{storeData.resIntroduce},
            res_reserve_time = #{storeData.resReserveTime}
        WHERE res_idx = #{resIdx}
    </update>

<!--    가게 시간 정보 저장 -->
    <insert id="insertTime" parameterType="com.example.team3_final_project_server.dto.TimeDTO">
        INSERT INTO restaurant_time (  day, start_time, end_time )
        VALUES (  #{day}, #{startTime} ,#{endTime} )
    </insert>

<!--    가게 정보 조회 -->
    <select id="getRestByUserIdx" parameterType="int" resultType="com.example.team3_final_project_server.dto.RestaurantDTO">
        SELECT user_idx, res_idx,  res_name, res_call, res_address1, res_address2, res_introduce, res_reserve_time, res_image1, res_image2, res_image3
        from restaurant
        WHERE user_idx = #{userIdx}
    </select>


<!--    좌석 정보 불러오기 -->
    <select id="loadSeat" parameterType="String" resultType="com.example.team3_final_project_server.dto.SeatDTO">
        SELECT
        seat_id As seatId,
        res_idx AS resIdx,
        type,
        name,
        x,
        y,
        image,
        is_selected As isSelected
        FROM seat_table
        WHERE res_idx = #{resIdx}
    </select>

<!--    좌석 수정하기 -->
    <update id="updateSeats" parameterType="com.example.team3_final_project_server.dto.SeatDTO">
        UPDATE seat_table
        SET x = #{x},
        y = #{y},
        res_idx = #{resIdx}
        WHERE seat_id = #{seatId}
    </update>


    <!--    좌석 삭제하기 -->
    <delete id="deleteSeat" parameterType="map">
        DELETE FROM seat_table
        WHERE seat_id = #{seatId} AND res_idx = #{resIdx}
    </delete>

</mapper>